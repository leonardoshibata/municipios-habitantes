---
title: "Número de habitantes por município"
output: html_notebook
---

```{r setup}
if(!require(pacman)) install.packages("pacman")
pacman::p_load(tidyverse)
pacman::p_load(sidrar)
pacman::p_load(pins)
pacman::p_load(brmap)
pacman::p_load(scales)
pacman::p_load(gganimate)
pacman::p_load(transformr)
pacman::p_load(gifski)
```

```{r data_import}
# populacao <- get_sidra(6579, period = "all", geo = "City", format = 3) %>% as_tibble()
# pin(populacao)

map_data <-
  pin_get("populacao") %>%
  mutate(
    municipio_cod = as.numeric(`Município (Código)`),
    ano = as.numeric(Ano)) %>%
  right_join(brmap::brmap_municipio_simples) %>%
  st_as_sf()

p <- ggplot(map_data) +
  labs(title = "Ano: {current_frame}") +
  geom_sf(aes(fill = Valor), color = NA) +
  coord_sf(datum = NA) +
  scale_fill_distiller(name = "População", palette = "Spectral", trans = "log10", labels = scales::label_number_si()) +
  transition_manual(ano)

animate(p, renderer = gifski_renderer())
anim_save("mapa.gif")
```


```{r quantile}
map_data %>%
  filter(ano == 2019) %>%
  mutate(
    bin = cut(Valor, breaks = quantile(Valor, na.rm = TRUE, probs = seq(0, 1, by = 0.15)))
  ) %>%
  ggplot() +
  geom_sf(aes(fill = bin), color = NA) +
  coord_sf(datum = NA) +
  # scale_fill_distiller(palette = "Spectral", trans = "log10", labels = scales::label_number_si())
  # scale_fill_brewer(palette = "OrRd")
  scale_fill_viridis_d(direction = -1)
```

