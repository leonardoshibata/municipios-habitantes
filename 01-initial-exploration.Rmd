---
title: "Número de habitantes por município"
output: html_notebook
---

```{r setup}
library(tidyverse)
library(sidrar)
library(pins)
library(brmap)
library(scales)
library(gganimate)
library(transformr)
# gifski
```

```{r data_import}
# populacao <- get_sidra(6579, period = "all", geo = "City", format = 3) %>% as_tibble()
# pin(populacao)

map_data <-
  pin_get("populacao") %>%
  mutate(
    municipio_cod = as.numeric(`Município (Código)`),
    ano = as.numeric(Ano)) %>%
  right_join(brmap::brmap_municipio_simples) %>%
  st_as_sf()

p <- ggplot(map_data) +
  labs(title = "Ano: {current_frame}") +
  geom_sf(aes(fill = Valor), color = NA) +
  coord_sf(datum = NA) +
  scale_fill_distiller(name = "População", palette = "Spectral", trans = "log10", labels = scales::label_number_si()) +
  transition_manual(ano)

animate(p, renderer = gifski_renderer())
anim_save("mapa.gif")
```

